import{r as s,j as t,H as g}from"./app-De-pmVM3.js";import{A as j}from"./app-layout-Dxf_lvi9.js";import{E as I}from"./event-calendar-DwZg_Pp2.js";import{s as T,a as A,e as R,t as E}from"./switch-3pypaVK_.js";/* empty css            */import"./button-BdDmD3PX.js";import"./input-CoQm3KMS.js";import"./index-B6sbAKco.js";import"./index-EvLH_iTT.js";import"./index-DCaLr7pc.js";import"./badge-B_aCqkrB.js";import"./tabs-D1-TJ5nh.js";import"./dialog-yQCJy72m.js";import"./card-CKPGcniq.js";import"./separator-BvO7FVTI.js";import"./label-D3AWD7T8.js";import"./checkbox-D-kc6QfU.js";import"./index-BubX4eo4.js";import"./loader-circle-DmR7l69q.js";const S="Europe/Stockholm",_=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,q=e=>{const o=e.extendedProps?.service_date?new Date(e.extendedProps.service_date):new Date,a=e.start?new Date(e.start):o,h=e.end?new Date(e.end):a,c=E(a,S),i=E(h,S),d=e.extendedProps?.start_time??_(c),p=e.extendedProps?.end_time??_(i);return{id:e.id.toString(),title:e.title||e.number||"Booking",description:e.description||"",startDate:c,endDate:i,startTime:d,endTime:p,isRepeating:!1,repeatingType:null,location:e.location??e.extendedProps?.location??"",category:e.category??e.extendedProps?.category??"General",color:e.color??e.extendedProps?.color??"#3b82f6",backgroundColor:e.backgroundColor??e.color??e.extendedProps?.color??"#3b82f6",textColor:e.textColor??"#ffffff",createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date,technicianId:e.resourceId?e.resourceId.toString():void 0,technicianName:e.extendedProps?.service_user_name??"",service_user_id:e.extendedProps?.service_user_id!==void 0?String(e.extendedProps.service_user_id):e.resourceId??void 0,booking_calendar_id:e.extendedProps?.booking_calendar_id!==void 0?String(e.extendedProps.booking_calendar_id):void 0,google_event_id:e.extendedProps?.google_event_id??void 0}},D=[{title:"Shadcn Event Calendar",href:"/shadcn-event-calendar"}];function ee(){const[e,o]=s.useState([]),[a,h]=s.useState([]),[c,i]=s.useState([]),[d,p]=s.useState("all"),[y,u]=s.useState(!0),[C,N]=s.useState([]),l=s.useCallback(async()=>{u(!0);try{const r=new Date,n=T(r),m=A(R(r),30),P=new URLSearchParams({start:n.toISOString(),end:m.toISOString()}),v=await fetch(`/api/calendar/bookings?${P.toString()}`);if(!v.ok)throw new Error("Failed to fetch bookings");const w=(await v.json()).map(q);h(w),o(w)}catch(r){console.error("Error fetching bookings:",r)}finally{u(!1)}},[]),f=s.useCallback(async()=>{try{const r=await fetch("/api/calendar/service-users");if(!r.ok)throw new Error("Failed to fetch technicians");const n=await r.json();i(n.map(m=>({id:String(m.id),name:m.name,picturePath:null})))}catch(r){console.error("Error fetching technicians:",r)}},[]),x=s.useCallback(async()=>{try{const r=await fetch("/api/calendar/categories");if(!r.ok)throw new Error("Failed to fetch categories");const n=await r.json();N(n)}catch(r){console.error("Error fetching categories:",r)}},[]);return s.useEffect(()=>{l(),f(),x()},[l,f,x]),s.useEffect(()=>{const r=()=>l();return window.addEventListener("booking:mutated",r),()=>window.removeEventListener("booking:mutated",r)},[l]),s.useEffect(()=>{if(d==="all"){o(a);return}const r=a.filter(n=>n.technicianId===d);o(r)},[d,a]),y?t.jsxs(j,{breadcrumbs:D,children:[t.jsx(g,{title:"Shadcn Event Calendar"}),t.jsx("div",{className:"w-full max-w-[100%]",children:t.jsx("div",{className:"bg-transparent rounded-lg shadow min-h-[98vh] flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black dark:border-white mx-auto"}),t.jsxs("svg",{version:"1.2",id:"nordic-logo",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2000 336",width:"200",height:"34",fill:"currentColor",children:[t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m1245.5 13.5q39 0 78 0 0.25 104-0.5 208-7.73 69.72-72.5 96.5-81.51 23.59-131.5-44.5-35.41-60.78 1-121 47.62-63.63 125.5-45 0-47 0-94zm-73 200q4.85 39.91 45 39.5 31.97-6.41 35-39-5.71-41.96-48-39.5-29.03 8.55-32 39z"})}),t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m655.5 101.5q73.88-5.44 112.5 57 31.23 64.88-11 123-49.57 55.58-121.5 35.5-62.5-23.77-74.5-89.5-6.8-72.15 53.5-111.5 19.47-10.74 41-14.5zm-10 79.5q-23.59 23.82-7.5 53.5 21.72 25.85 52.5 11.5 20.62-12.99 19.5-37.5-7.55-39.17-47.5-36-9.15 2.65-17 8.5z"})}),t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m1623.5 101.5q54.97-5.93 94 32.5-24.5 24.5-49 49-1.5 1-3 0-19.76-16.75-44-7-27.69 16.05-20.5 47.5 15.61 36.43 53.5 24.5 7.07-3.08 12.5-8.5 25.25 25.25 50.5 50.5-54.66 49.83-124 23-54.24-26.7-64.5-86.5-5.65-83.98 70.5-118.5 12.06-3.76 24-6.5z"})}),t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m381.5 106.5q59 0 118 0 0 105 0 210-42 0-84 0 0-63 0-126-27 0-54 0 0 63 0 126-43 0-86 0-0.25-52 0.5-104 53.05-52.8 105.5-106z"})}),t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m944.5 106.5q50 0 100 0 0 42 0 84-60 0-120 0 0 63 0 126-43 0-86 0-0.25-52 0.5-104 53.05-52.8 105.5-106z"})}),t.jsx("g",{children:t.jsx("path",{fillRule:"evenodd",className:"s0",d:"m1385.5 106.5q42 0 84 0 0 105 0 210-42 0-84 0 0-105 0-210z"})})]})]})})})]}):t.jsxs(j,{breadcrumbs:D,children:[t.jsx(g,{title:"NDS Calendar"}),t.jsx("div",{className:"w-full max-w-[100%]",children:t.jsx("div",{className:"bg-transparent rounded-lg max-h-[96vh] min-h-[96vh] p-0",children:t.jsx(I,{events:e,initialDate:new Date,users:c,selectedTechnicianId:d,onTechnicianChange:p,totalEvents:a.length,categoryOptions:C})})})]})}export{ee as default};
