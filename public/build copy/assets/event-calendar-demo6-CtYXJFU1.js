import{r as n,u as J,j as e}from"./app-De-pmVM3.js";import{E as L}from"./event-calendar-D93KTxTg.js";function ee(){const[f,S]=n.useState({clients:[],services:[],locations:[],serviceUsers:[],calendars:[]}),[g,R]=n.useState(null),[P,k]=n.useState(!1),[v,p]=n.useState({name:"",email:"",phone:""}),[_,d]=n.useState([]),[C,w]=n.useState(!1),[F,u]=n.useState(!1),[G,b]=n.useState(null),[x,y]=n.useState(null),[i,N]=n.useState(!1),[E,j]=n.useState([]),[T,D]=n.useState(""),{data:l,setData:a,post:H,put:W,delete:Z,processing:O,reset:h}=J({service_date:"",start_time:"",end_time:"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:"",booking_calendar_id:"",status:"booked",total_price:"",notes:"",service_note:""});n.useEffect(()=>{(async()=>{try{const r=await(await fetch("/calendar/resources")).json();r&&r.length>3&&R(r[3])}catch(s){console.error("Error loading technician:",s)}})()},[]),n.useEffect(()=>{(async()=>{try{const[s,r,o,c,m]=await Promise.all([fetch("/api/calendar/clients"),fetch("/api/calendar/services"),fetch("/api/calendar/locations"),fetch("/api/calendar/service-users"),fetch("/api/calendar/calendars")]),[K,z,U,V,X]=await Promise.all([s.json(),r.json(),o.json(),c.json(),m.json()]);S({clients:K,services:z,locations:U,serviceUsers:V,calendars:X})}catch(s){console.error("Error loading dropdown data:",s)}})()},[]);const I=n.useCallback(t=>{const s=new Date(t.start),r=t.end?new Date(t.end):null;b({start:s,end:r,allDay:t.allDay,resourceId:t.resource?.id}),a(o=>({...o,service_date:s.toISOString().split("T")[0],start_time:s.toTimeString().slice(0,5),end_time:r?r.toTimeString().slice(0,5):"",service_user_id:t.resource?.id||g?.id||""})),N(!1),u(!0)},[a,g]),A=n.useCallback(t=>{const s=t.event;y({id:s.id,title:s.title,start:s.start,end:s.end,extendedProps:s.extendedProps});const r=s.extendedProps;a(o=>({...o,service_date:r.service_date||s.start?.toISOString().split("T")[0]||"",start_time:r.start_time||s.start?.toTimeString().slice(0,5)||"",end_time:r.end_time||s.end?.toTimeString().slice(0,5)||"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:s.getResource()?.id||"",status:r.status||"booked",total_price:r.total_price||"",notes:r.notes||"",service_note:""})),N(!0),u(!0)},[a]),M=n.useCallback(async t=>{const s=t.event,r=s.start,o=s.end,c=s.getResource()?.id;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/move`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({start:r.toISOString(),end:o?o.toISOString():null,resource_id:c})})).ok)throw new Error("Failed to move booking");window.location.reload()}catch(m){console.error("Error moving booking:",m),t.revert()}},[]),$=n.useCallback(async t=>{const s=t.event,r=s.end;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/resize`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({end:r.toISOString()})})).ok)throw new Error("Failed to resize booking");window.location.reload()}catch(o){console.error("Error resizing booking:",o),t.revert()}},[]),q=n.useCallback(async t=>{t.preventDefault(),j([]),D("");try{const s=i?`/api/calendar/bookings/${x?.id}`:"/api/calendar/bookings",o=await fetch(s,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(l)}),c=await o.json();if(!o.ok){if(c.errors){const m=Object.values(c.errors).flat();j(m)}else j([c.message||`Failed to ${i?"update":"create"} booking`]);return}D(c.message||`Booking ${i?"updated":"created"} successfully`),setTimeout(()=>{u(!1),h(),y(null),b(null),window.location.reload()},1500)}catch(s){console.error(`Error ${i?"updating":"creating"} booking:`,s),j(["An unexpected error occurred. Please try again."])}},[l,i,x?.id,h]),B=n.useCallback(async()=>{if(x?.id)try{if(!(await fetch(`/api/calendar/bookings/${x.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok)throw new Error("Failed to delete booking");u(!1),h(),y(null),b(null),window.location.reload()}catch(t){console.error("Error deleting booking:",t)}},[x?.id,h]);return e.jsxs(e.Fragment,{children:[g?e.jsx(L,{className:"mx-auto my-10 max-w-300",editable:!0,selectable:!0,droppable:!0,nowIndicator:!0,navLinks:!0,locale:"sv",initialView:"timeGridWeek",firstDay:1,timeZone:"Europe/Stockholm",events:`/api/calendar/bookings?service_user_id=${g.id}`,resources:"/calendar/resources",select:I,eventClick:A,eventDrop:M,eventResize:$,headerToolbar:{left:"",center:"",right:""},slotMinTime:"07:00:00",slotMaxTime:"20:00:00",slotDuration:"01:00:00",weekends:!0,addButton:{text:`${g.title}`,click(){N(!1),b({start:new Date,end:new Date(Date.now()+3600*1e3),allDay:!1}),u(!0)}}}):e.jsx("div",{className:"mx-auto my-10 max-w-300 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Laddar kalender..."})]})}),F&&e.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black",children:e.jsxs("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-lg bg-white p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:i?"Redigera Bokning":"Ny Bokning"}),T&&e.jsx("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:e.jsx("div",{className:"text-green-800",children:T})}),E.length>0&&e.jsx("div",{className:"mb-4 rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"text-red-800",children:E.map((t,s)=>e.jsx("div",{className:"mb-1",children:t},s))})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Datum"}),e.jsx("input",{type:"date",value:l.service_date,onChange:t=>a("service_date",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:l.status,onChange:t=>a("status",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"booked",children:"Bokad"}),e.jsx("option",{value:"confirmed",children:"Bekräftad"}),e.jsx("option",{value:"cancelled",children:"Inställd"}),e.jsx("option",{value:"completed",children:"Genomförd"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Starttid"}),e.jsx("input",{type:"time",value:l.start_time,onChange:t=>a("start_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Sluttid"}),e.jsx("input",{type:"time",value:l.end_time,onChange:t=>a("end_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Kund"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:l.booking_client_id,onChange:t=>a("booking_client_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj kund"}),f.clients.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{k(t=>!t),d([])},children:"Lägg till ny kund"})]}),P&&e.jsxs("div",{className:"mt-3 space-y-2 rounded-md border border-gray-200 p-3",children:[_.length>0&&e.jsx("div",{className:"rounded-md bg-red-50 p-2 text-sm text-red-700",children:_.map((t,s)=>e.jsx("div",{children:t},s))}),e.jsx("input",{type:"text",placeholder:"Namn",value:v.name,onChange:t=>p(s=>({...s,name:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"email",placeholder:"E-post (valfritt)",value:v.email,onChange:t=>p(s=>({...s,email:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Telefon (valfritt)",value:v.phone,onChange:t=>p(s=>({...s,phone:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),p({name:"",email:"",phone:""}),d([])},className:"mr-2 rounded-md bg-gray-200 px-3 py-1 text-sm",children:"Avbryt"}),e.jsx("button",{type:"button",disabled:C,onClick:async()=>{d([]),w(!0);try{const t=await fetch("/api/calendar/clients",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(v)}),s=await t.json();if(!t.ok){if(s.errors){const r=Object.values(s.errors).flat();d(r)}else s.message?d([s.message]):d(["Ett fel uppstod."]);w(!1);return}S(r=>({...r,clients:[s,...r.clients]})),a("booking_client_id",s.id),k(!1),p({name:"",email:"",phone:""})}catch(t){console.error("Error creating client",t),d(["Ett fel uppstod."])}finally{w(!1)}},className:"rounded-md bg-blue-600 px-3 py-1 text-white disabled:opacity-50 text-sm",children:C?"Sparar...":"Skapa kund"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tjänst"}),e.jsxs("select",{value:l.service_id,onChange:t=>a("service_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tjänst"}),f.services.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Plats"}),e.jsxs("select",{value:l.booking_location_id,onChange:t=>a("booking_location_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj plats"}),f.locations.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tekniker"}),e.jsxs("select",{value:l.service_user_id,onChange:t=>a("service_user_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tekniker"}),f.serviceUsers.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Pris (SEK)"}),e.jsx("input",{type:"number",value:l.total_price,onChange:t=>a("total_price",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Interna anteckningar"}),e.jsx("textarea",{value:l.notes,onChange:t=>a("notes",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Service anteckningar"}),e.jsx("textarea",{value:l.service_note,onChange:t=>a("service_note",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("div",{children:i&&e.jsx("button",{type:"button",onClick:B,className:"rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:outline-none",children:"Radera"})}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),h(),y(null),b(null)},className:"rounded-md bg-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-400 focus:ring-2 focus:ring-gray-500 focus:outline-none",children:"Avbryt"}),e.jsx("button",{type:"submit",disabled:O,className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:opacity-50",children:O?"Sparar...":i?"Uppdatera":"Skapa"})]})]})]})]})})]})}function te(){const[f,S]=n.useState({clients:[],services:[],locations:[],serviceUsers:[],calendars:[]}),[g,R]=n.useState(null),[P,k]=n.useState(!1),[v,p]=n.useState({name:"",email:"",phone:""}),[_,d]=n.useState([]),[C,w]=n.useState(!1),[F,u]=n.useState(!1),[G,b]=n.useState(null),[x,y]=n.useState(null),[i,N]=n.useState(!1),[E,j]=n.useState([]),[T,D]=n.useState(""),{data:l,setData:a,post:H,put:W,delete:Z,processing:O,reset:h}=J({service_date:"",start_time:"",end_time:"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:"",booking_calendar_id:"",status:"booked",total_price:"",notes:"",service_note:""});n.useEffect(()=>{(async()=>{try{const r=await(await fetch("/calendar/resources")).json();r&&r.length>4&&R(r[4])}catch(s){console.error("Error loading technician:",s)}})()},[]),n.useEffect(()=>{(async()=>{try{const[s,r,o,c,m]=await Promise.all([fetch("/api/calendar/clients"),fetch("/api/calendar/services"),fetch("/api/calendar/locations"),fetch("/api/calendar/service-users"),fetch("/api/calendar/calendars")]),[K,z,U,V,X]=await Promise.all([s.json(),r.json(),o.json(),c.json(),m.json()]);S({clients:K,services:z,locations:U,serviceUsers:V,calendars:X})}catch(s){console.error("Error loading dropdown data:",s)}})()},[]);const I=n.useCallback(t=>{const s=new Date(t.start),r=t.end?new Date(t.end):null;b({start:s,end:r,allDay:t.allDay,resourceId:t.resource?.id}),a(o=>({...o,service_date:s.toISOString().split("T")[0],start_time:s.toTimeString().slice(0,5),end_time:r?r.toTimeString().slice(0,5):"",service_user_id:t.resource?.id||g?.id||""})),N(!1),u(!0)},[a,g]),A=n.useCallback(t=>{const s=t.event;y({id:s.id,title:s.title,start:s.start,end:s.end,extendedProps:s.extendedProps});const r=s.extendedProps;a(o=>({...o,service_date:r.service_date||s.start?.toISOString().split("T")[0]||"",start_time:r.start_time||s.start?.toTimeString().slice(0,5)||"",end_time:r.end_time||s.end?.toTimeString().slice(0,5)||"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:s.getResource()?.id||"",status:r.status||"booked",total_price:r.total_price||"",notes:r.notes||"",service_note:""})),N(!0),u(!0)},[a]),M=n.useCallback(async t=>{const s=t.event,r=s.start,o=s.end,c=s.getResource()?.id;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/move`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({start:r.toISOString(),end:o?o.toISOString():null,resource_id:c})})).ok)throw new Error("Failed to move booking");window.location.reload()}catch(m){console.error("Error moving booking:",m),t.revert()}},[]),$=n.useCallback(async t=>{const s=t.event,r=s.end;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/resize`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({end:r.toISOString()})})).ok)throw new Error("Failed to resize booking");window.location.reload()}catch(o){console.error("Error resizing booking:",o),t.revert()}},[]),q=n.useCallback(async t=>{t.preventDefault(),j([]),D("");try{const s=i?`/api/calendar/bookings/${x?.id}`:"/api/calendar/bookings",o=await fetch(s,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(l)}),c=await o.json();if(!o.ok){if(c.errors){const m=Object.values(c.errors).flat();j(m)}else j([c.message||`Failed to ${i?"update":"create"} booking`]);return}D(c.message||`Booking ${i?"updated":"created"} successfully`),setTimeout(()=>{u(!1),h(),y(null),b(null),window.location.reload()},1500)}catch(s){console.error(`Error ${i?"updating":"creating"} booking:`,s),j(["An unexpected error occurred. Please try again."])}},[l,i,x?.id,h]),B=n.useCallback(async()=>{if(x?.id)try{if(!(await fetch(`/api/calendar/bookings/${x.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok)throw new Error("Failed to delete booking");u(!1),h(),y(null),b(null),window.location.reload()}catch(t){console.error("Error deleting booking:",t)}},[x?.id,h]);return e.jsxs(e.Fragment,{children:[g?e.jsx(L,{className:"mx-auto my-10 max-w-300",editable:!0,selectable:!0,droppable:!0,nowIndicator:!0,navLinks:!0,locale:"sv",initialView:"timeGridWeek",firstDay:1,timeZone:"Europe/Stockholm",events:`/api/calendar/bookings?service_user_id=${g.id}`,resources:"/calendar/resources",select:I,eventClick:A,eventDrop:M,eventResize:$,headerToolbar:{left:"",center:"",right:""},slotMinTime:"07:00:00",slotMaxTime:"20:00:00",slotDuration:"01:00:00",weekends:!0,addButton:{text:`${g.title}`,click(){N(!1),b({start:new Date,end:new Date(Date.now()+3600*1e3),allDay:!1}),u(!0)}}}):e.jsx("div",{className:"mx-auto my-10 max-w-300 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Laddar kalender..."})]})}),F&&e.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black",children:e.jsxs("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-lg bg-white p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:i?"Redigera Bokning":"Ny Bokning"}),T&&e.jsx("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:e.jsx("div",{className:"text-green-800",children:T})}),E.length>0&&e.jsx("div",{className:"mb-4 rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"text-red-800",children:E.map((t,s)=>e.jsx("div",{className:"mb-1",children:t},s))})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Datum"}),e.jsx("input",{type:"date",value:l.service_date,onChange:t=>a("service_date",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:l.status,onChange:t=>a("status",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"booked",children:"Bokad"}),e.jsx("option",{value:"confirmed",children:"Bekräftad"}),e.jsx("option",{value:"cancelled",children:"Inställd"}),e.jsx("option",{value:"completed",children:"Genomförd"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Starttid"}),e.jsx("input",{type:"time",value:l.start_time,onChange:t=>a("start_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Sluttid"}),e.jsx("input",{type:"time",value:l.end_time,onChange:t=>a("end_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Kund"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:l.booking_client_id,onChange:t=>a("booking_client_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj kund"}),f.clients.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{k(t=>!t),d([])},children:"Lägg till ny kund"})]}),P&&e.jsxs("div",{className:"mt-3 space-y-2 rounded-md border border-gray-200 p-3",children:[_.length>0&&e.jsx("div",{className:"rounded-md bg-red-50 p-2 text-sm text-red-700",children:_.map((t,s)=>e.jsx("div",{children:t},s))}),e.jsx("input",{type:"text",placeholder:"Namn",value:v.name,onChange:t=>p(s=>({...s,name:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"email",placeholder:"E-post (valfritt)",value:v.email,onChange:t=>p(s=>({...s,email:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Telefon (valfritt)",value:v.phone,onChange:t=>p(s=>({...s,phone:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),p({name:"",email:"",phone:""}),d([])},className:"mr-2 rounded-md bg-gray-200 px-3 py-1 text-sm",children:"Avbryt"}),e.jsx("button",{type:"button",disabled:C,onClick:async()=>{d([]),w(!0);try{const t=await fetch("/api/calendar/clients",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(v)}),s=await t.json();if(!t.ok){if(s.errors){const r=Object.values(s.errors).flat();d(r)}else s.message?d([s.message]):d(["Ett fel uppstod."]);w(!1);return}S(r=>({...r,clients:[s,...r.clients]})),a("booking_client_id",s.id),k(!1),p({name:"",email:"",phone:""})}catch(t){console.error("Error creating client",t),d(["Ett fel uppstod."])}finally{w(!1)}},className:"rounded-md bg-blue-600 px-3 py-1 text-white disabled:opacity-50 text-sm",children:C?"Sparar...":"Skapa kund"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tjänst"}),e.jsxs("select",{value:l.service_id,onChange:t=>a("service_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tjänst"}),f.services.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Plats"}),e.jsxs("select",{value:l.booking_location_id,onChange:t=>a("booking_location_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj plats"}),f.locations.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tekniker"}),e.jsxs("select",{value:l.service_user_id,onChange:t=>a("service_user_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tekniker"}),f.serviceUsers.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Pris (SEK)"}),e.jsx("input",{type:"number",value:l.total_price,onChange:t=>a("total_price",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Interna anteckningar"}),e.jsx("textarea",{value:l.notes,onChange:t=>a("notes",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Service anteckningar"}),e.jsx("textarea",{value:l.service_note,onChange:t=>a("service_note",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("div",{children:i&&e.jsx("button",{type:"button",onClick:B,className:"rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:outline-none",children:"Radera"})}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),h(),y(null),b(null)},className:"rounded-md bg-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-400 focus:ring-2 focus:ring-gray-500 focus:outline-none",children:"Avbryt"}),e.jsx("button",{type:"submit",disabled:O,className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:opacity-50",children:O?"Sparar...":i?"Uppdatera":"Skapa"})]})]})]})]})})]})}function se(){const[f,S]=n.useState({clients:[],services:[],locations:[],serviceUsers:[],calendars:[]}),[g,R]=n.useState(null),[P,k]=n.useState(!1),[v,p]=n.useState({name:"",email:"",phone:""}),[_,d]=n.useState([]),[C,w]=n.useState(!1),[F,u]=n.useState(!1),[G,b]=n.useState(null),[x,y]=n.useState(null),[i,N]=n.useState(!1),[E,j]=n.useState([]),[T,D]=n.useState(""),{data:l,setData:a,post:H,put:W,delete:Z,processing:O,reset:h}=J({service_date:"",start_time:"",end_time:"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:"",booking_calendar_id:"",status:"booked",total_price:"",notes:"",service_note:""});n.useEffect(()=>{(async()=>{try{const r=await(await fetch("/calendar/resources")).json();r&&r.length>5&&R(r[5])}catch(s){console.error("Error loading technician:",s)}})()},[]),n.useEffect(()=>{(async()=>{try{const[s,r,o,c,m]=await Promise.all([fetch("/api/calendar/clients"),fetch("/api/calendar/services"),fetch("/api/calendar/locations"),fetch("/api/calendar/service-users"),fetch("/api/calendar/calendars")]),[K,z,U,V,X]=await Promise.all([s.json(),r.json(),o.json(),c.json(),m.json()]);S({clients:K,services:z,locations:U,serviceUsers:V,calendars:X})}catch(s){console.error("Error loading dropdown data:",s)}})()},[]);const I=n.useCallback(t=>{const s=new Date(t.start),r=t.end?new Date(t.end):null;b({start:s,end:r,allDay:t.allDay,resourceId:t.resource?.id}),a(o=>({...o,service_date:s.toISOString().split("T")[0],start_time:s.toTimeString().slice(0,5),end_time:r?r.toTimeString().slice(0,5):"",service_user_id:t.resource?.id||g?.id||""})),N(!1),u(!0)},[a,g]),A=n.useCallback(t=>{const s=t.event;y({id:s.id,title:s.title,start:s.start,end:s.end,extendedProps:s.extendedProps});const r=s.extendedProps;a(o=>({...o,service_date:r.service_date||s.start?.toISOString().split("T")[0]||"",start_time:r.start_time||s.start?.toTimeString().slice(0,5)||"",end_time:r.end_time||s.end?.toTimeString().slice(0,5)||"",booking_client_id:"",service_id:"",booking_location_id:"",service_user_id:s.getResource()?.id||"",status:r.status||"booked",total_price:r.total_price||"",notes:r.notes||"",service_note:""})),N(!0),u(!0)},[a]),M=n.useCallback(async t=>{const s=t.event,r=s.start,o=s.end,c=s.getResource()?.id;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/move`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({start:r.toISOString(),end:o?o.toISOString():null,resource_id:c})})).ok)throw new Error("Failed to move booking");window.location.reload()}catch(m){console.error("Error moving booking:",m),t.revert()}},[]),$=n.useCallback(async t=>{const s=t.event,r=s.end;try{if(!(await fetch(`/api/calendar/bookings/${s.id}/resize`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({end:r.toISOString()})})).ok)throw new Error("Failed to resize booking");window.location.reload()}catch(o){console.error("Error resizing booking:",o),t.revert()}},[]),q=n.useCallback(async t=>{t.preventDefault(),j([]),D("");try{const s=i?`/api/calendar/bookings/${x?.id}`:"/api/calendar/bookings",o=await fetch(s,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(l)}),c=await o.json();if(!o.ok){if(c.errors){const m=Object.values(c.errors).flat();j(m)}else j([c.message||`Failed to ${i?"update":"create"} booking`]);return}D(c.message||`Booking ${i?"updated":"created"} successfully`),setTimeout(()=>{u(!1),h(),y(null),b(null),window.location.reload()},1500)}catch(s){console.error(`Error ${i?"updating":"creating"} booking:`,s),j(["An unexpected error occurred. Please try again."])}},[l,i,x?.id,h]),B=n.useCallback(async()=>{if(x?.id)try{if(!(await fetch(`/api/calendar/bookings/${x.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok)throw new Error("Failed to delete booking");u(!1),h(),y(null),b(null),window.location.reload()}catch(t){console.error("Error deleting booking:",t)}},[x?.id,h]);return e.jsxs(e.Fragment,{children:[g?e.jsx(L,{className:"mx-auto my-10 max-w-300",editable:!0,selectable:!0,droppable:!0,nowIndicator:!0,navLinks:!0,locale:"sv",initialView:"timeGridWeek",firstDay:1,timeZone:"Europe/Stockholm",events:`/api/calendar/bookings?service_user_id=${g.id}`,resources:"/calendar/resources",select:I,eventClick:A,eventDrop:M,eventResize:$,headerToolbar:{left:"",center:"",right:""},slotMinTime:"07:00:00",slotMaxTime:"20:00:00",slotDuration:"01:00:00",weekends:!0,addButton:{text:`${g.title}`,click(){N(!1),b({start:new Date,end:new Date(Date.now()+3600*1e3),allDay:!1}),u(!0)}}}):e.jsx("div",{className:"mx-auto my-10 max-w-300 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Laddar kalender..."})]})}),F&&e.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black",children:e.jsxs("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-lg bg-white p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:i?"Redigera Bokning":"Ny Bokning"}),T&&e.jsx("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:e.jsx("div",{className:"text-green-800",children:T})}),E.length>0&&e.jsx("div",{className:"mb-4 rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"text-red-800",children:E.map((t,s)=>e.jsx("div",{className:"mb-1",children:t},s))})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Datum"}),e.jsx("input",{type:"date",value:l.service_date,onChange:t=>a("service_date",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:l.status,onChange:t=>a("status",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"booked",children:"Bokad"}),e.jsx("option",{value:"confirmed",children:"Bekräftad"}),e.jsx("option",{value:"cancelled",children:"Inställd"}),e.jsx("option",{value:"completed",children:"Genomförd"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Starttid"}),e.jsx("input",{type:"time",value:l.start_time,onChange:t=>a("start_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Sluttid"}),e.jsx("input",{type:"time",value:l.end_time,onChange:t=>a("end_time",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Kund"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:l.booking_client_id,onChange:t=>a("booking_client_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj kund"}),f.clients.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{k(t=>!t),d([])},children:"Lägg till ny kund"})]}),P&&e.jsxs("div",{className:"mt-3 space-y-2 rounded-md border border-gray-200 p-3",children:[_.length>0&&e.jsx("div",{className:"rounded-md bg-red-50 p-2 text-sm text-red-700",children:_.map((t,s)=>e.jsx("div",{children:t},s))}),e.jsx("input",{type:"text",placeholder:"Namn",value:v.name,onChange:t=>p(s=>({...s,name:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"email",placeholder:"E-post (valfritt)",value:v.email,onChange:t=>p(s=>({...s,email:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Telefon (valfritt)",value:v.phone,onChange:t=>p(s=>({...s,phone:t.target.value})),className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),p({name:"",email:"",phone:""}),d([])},className:"mr-2 rounded-md bg-gray-200 px-3 py-1 text-sm",children:"Avbryt"}),e.jsx("button",{type:"button",disabled:C,onClick:async()=>{d([]),w(!0);try{const t=await fetch("/api/calendar/clients",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(v)}),s=await t.json();if(!t.ok){if(s.errors){const r=Object.values(s.errors).flat();d(r)}else s.message?d([s.message]):d(["Ett fel uppstod."]);w(!1);return}S(r=>({...r,clients:[s,...r.clients]})),a("booking_client_id",s.id),k(!1),p({name:"",email:"",phone:""})}catch(t){console.error("Error creating client",t),d(["Ett fel uppstod."])}finally{w(!1)}},className:"rounded-md bg-blue-600 px-3 py-1 text-white disabled:opacity-50 text-sm",children:C?"Sparar...":"Skapa kund"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tjänst"}),e.jsxs("select",{value:l.service_id,onChange:t=>a("service_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tjänst"}),f.services.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Plats"}),e.jsxs("select",{value:l.booking_location_id,onChange:t=>a("booking_location_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj plats"}),f.locations.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tekniker"}),e.jsxs("select",{value:l.service_user_id,onChange:t=>a("service_user_id",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Välj tekniker"}),f.serviceUsers.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Pris (SEK)"}),e.jsx("input",{type:"number",value:l.total_price,onChange:t=>a("total_price",t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Interna anteckningar"}),e.jsx("textarea",{value:l.notes,onChange:t=>a("notes",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Service anteckningar"}),e.jsx("textarea",{value:l.service_note,onChange:t=>a("service_note",t.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("div",{children:i&&e.jsx("button",{type:"button",onClick:B,className:"rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:outline-none",children:"Radera"})}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),h(),y(null),b(null)},className:"rounded-md bg-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-400 focus:ring-2 focus:ring-gray-500 focus:outline-none",children:"Avbryt"}),e.jsx("button",{type:"submit",disabled:O,className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:opacity-50",children:O?"Sparar...":i?"Uppdatera":"Skapa"})]})]})]})]})})]})}export{ee as E,te as a,se as b};
