import{r as m,j as e,H as j}from"./app-De-pmVM3.js";import{A as k}from"./app-layout-Dxf_lvi9.js";import{d as S}from"./index-DCaLr7pc.js";import{R as N}from"./resource-timeline-C2IL2krJ.js";import{B as _}from"./button-BdDmD3PX.js";import{I as i}from"./input-CoQm3KMS.js";import{L as n}from"./label-D3AWD7T8.js";/* empty css            */import"./index-B6sbAKco.js";import"./index-EvLH_iTT.js";import"./event-calendar-views-CFG-p721.js";import"./tabs-D1-TJ5nh.js";function y({onSubmit:x,loading:h=!1}){const[r,d]=m.useState({service_date:new Date().toISOString().split("T")[0],start_time:"07:00",end_time:"10:00",status:"booked"}),s=p=>{const{name:c,value:u,type:g}=p.target;d(b=>({...b,[c]:g==="number"?parseFloat(u):u}))},l=p=>{p.preventDefault(),x?.(r)};return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"service_date",className:"text-sm",children:"Servicedatum *"}),e.jsx(i,{id:"service_date",name:"service_date",type:"date",value:r.service_date,onChange:s,required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"start_time",className:"text-sm",children:"Starttid *"}),e.jsx(i,{id:"start_time",name:"start_time",type:"time",value:r.start_time,onChange:s,required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"end_time",className:"text-sm",children:"Sluttid *"}),e.jsx(i,{id:"end_time",name:"end_time",type:"time",value:r.end_time,onChange:s,required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"status",className:"text-sm",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:r.status||"booked",onChange:s,className:"w-full px-3 py-2 border border-input rounded-md bg-background",children:[e.jsx("option",{value:"booked",children:"Bokad"}),e.jsx("option",{value:"confirmed",children:"Bekräftad"}),e.jsx("option",{value:"cancelled",children:"Inställd"}),e.jsx("option",{value:"completed",children:"Slutförd"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phone",className:"text-sm",children:"Telefon"}),e.jsx(i,{id:"phone",name:"phone",type:"tel",placeholder:"+46...",value:r.phone||"",onChange:s})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"email",className:"text-sm",children:"E-post"}),e.jsx(i,{id:"email",name:"email",type:"email",placeholder:"namn@exempel.se",value:r.email||"",onChange:s})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"total_price",className:"text-sm",children:"Pris (SEK)"}),e.jsx(i,{id:"total_price",name:"total_price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:r.total_price||"",onChange:s})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"service_user_id",className:"text-sm",children:"Tekniker ID"}),e.jsx(i,{id:"service_user_id",name:"service_user_id",type:"number",placeholder:"ID",value:r.service_user_id||"",onChange:s})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"notes",className:"text-sm",children:"Anteckningar"}),e.jsx("textarea",{id:"notes",name:"notes",rows:3,placeholder:"Lägg till anteckningar om bokningen...",value:r.notes||"",onChange:s,className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"service_note",className:"text-sm",children:"Serviceanteckningar"}),e.jsx("textarea",{id:"service_note",name:"service_note",rows:3,placeholder:"Interna anteckningar för serviceteamet...",value:r.service_note||"",onChange:s,className:"w-full px-3 py-2 border border-input rounded-md bg-background text-sm"})]}),e.jsx(_,{type:"submit",disabled:h,className:"w-full",children:h?"Sparar...":"Skapa bokning"})]})}function w(){const[x,h]=m.useState([]),[r,d]=m.useState(!1),[s,l]=m.useState(!1),[p,c]=m.useState(null);m.useEffect(()=>{u()},[]);const u=async()=>{try{d(!0);const t=new Date,a=new Date(t.getTime()+720*60*60*1e3),o=await fetch(`/api/calendar/bookings?start=${t.toISOString()}&end=${a.toISOString()}`);if(o.ok){const f=await o.json();h(f)}}catch(t){console.error("Failed to fetch events:",t)}finally{d(!1)}},g=t=>{const a=new Date(t.start),o=new Date(t.end),f=String(a.getHours()).padStart(2,"0")+":"+String(a.getMinutes()).padStart(2,"0"),v=String(o.getHours()).padStart(2,"0")+":"+String(o.getMinutes()).padStart(2,"0");c({service_date:a.toISOString().split("T")[0],start_time:f,end_time:v,service_user_id:t.resourceId?parseInt(t.resourceId):void 0}),l(!0)},b=async t=>{try{d(!0);const a=await fetch("/api/calendar/bookings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify(t)});if(a.ok)l(!1),c(null),await u();else{const o=await a.json();console.error("Booking error:",o),alert("Fel vid skapande av bokning. Kontrollera formuläret.")}}catch(a){console.error("Failed to create booking:",a),alert("Ett fel uppstod. Försök igen senare.")}finally{d(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative h-[600px] overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border",children:e.jsx(N,{className:"h-full",schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",editable:!0,selectable:!0,selectConstraint:"businessHours",select:g,nowIndicator:!0,navLinks:!0,locale:"sv",initialView:"resourceTimelineWeek",height:"100%",contentHeight:"auto",timeZone:"UTC",resourceColumnHeaderContent:"Tekniker",resources:"calendar/resources?with-nesting&with-colors",events:"calendar/events?with-resource-timeline",addButton:{text:"Ny bokning",click(){l(!0),c(null)}}})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-xl bg-background p-6 shadow-lg",children:[e.jsx("button",{onClick:()=>{l(!1),c(null)},className:"absolute right-4 top-4 text-muted-foreground hover:text-foreground",children:"✕"}),e.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Ny bokning"}),e.jsx(y,{onSubmit:b,loading:r})]})}),e.jsxs("div",{className:"rounded-xl border border-sidebar-border/70 dark:border-sidebar-border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Kommande bokningar"}),x.length===0?e.jsx("p",{className:"text-muted-foreground",children:"Inga bokningar ännu"}):e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsx("div",{className:"rounded-lg border border-sidebar-border/50 p-4 hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.extendedProps?.client_name&&`Klient: ${t.extendedProps.client_name}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.extendedProps?.service_name&&`Service: ${t.extendedProps.service_name}`}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(t.start).toLocaleString("sv-SE"),t.end?` - ${new Date(t.end).toLocaleTimeString("sv-SE")}`:""]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${t.extendedProps?.status==="confirmed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":t.extendedProps?.status==="cancelled"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"}`,children:t.extendedProps?.status==="confirmed"?"Bekräftad":t.extendedProps?.status==="cancelled"?"Inställd":"Bokad"})})]})},t.id))})]})]})}const C=[{title:"Bokningar",href:S().url}];function q(){return e.jsxs(k,{breadcrumbs:C,children:[e.jsx(j,{title:"Bokningar"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4 bg-background",children:e.jsx(w,{})})]})}export{q as default};
